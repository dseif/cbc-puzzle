//  Thanks to Paul Irish for this code
window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       || 
                window.webkitRequestAnimationFrame || 
                window.mozRequestAnimationFrame    || 
                window.oRequestAnimationFrame      || 
                window.msRequestAnimationFrame     || 
                function(/* function */ callback, /* DOMElement */ element){
                  window.setTimeout(callback, 1000 / 60);
                };
})();

var Cbc = function( target ) {
console.log( target );
  this.audioElement = document.getElementById( target );
  console.log( this.audioElement );
  this.events = [];

  this.counter = 0;

  var animloop = function( options ) {
    
    if ( audioElement.currentTime >= options.end ) {
      this.audioElement.pause();
    } else { 
      requestAnimFrame( function(){
         animloop( options ); 
      });
    }
  };
  this.registerEvent = function( options ) {

    var target = document.getElementById( options.target ),
        eventDiv = document.createElement( "div" );

    options.eventDiv = eventDiv;
    this.events.push( options );

    eventDiv.id = "cbc-event-" + this.counter++;
    eventDiv.innerHTML = options.text;
    eventDiv.addEventListener( "click", function( event ) {
console.log(this.audioElement);
      this.audioElement.currentTime = options.start;
      requestAnimFrame( function() {
        animloop( options );
      });
      audioElement.play();
    }, false );

    target.appendChild( eventDiv );

  }
}

